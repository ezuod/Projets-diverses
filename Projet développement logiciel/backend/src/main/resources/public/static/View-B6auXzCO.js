import{d as B,r as I,f as V,c as C,a as h,t as M,o as p,j,k as E,l as O,m as U,u as G,p as X,w as Z,q as J,s as K,F as k,h as Q,x as Y,b as tt}from"./index-6l5cUpBE.js";import{a as T}from"./http-api-C6L_lunH.js";import{_ as A}from"./Image.vue_vue_type_style_index_0_lang-C-u1tQBl.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const et={key:0,class:"details-container"},rt={class:"details-name"},at={class:"details-meta"},nt={key:1},it=B({__name:"Details",props:{id:{}},setup(t){const e=t,r=I(null);return V(async()=>{try{const a=await T.getImageDetails(e.id);r.value=a}catch(a){console.error("Failed to fetch image details:",a)}}),(a,n)=>r.value?(p(),C("div",et,[h("div",null,[h("h4",rt,M(r.value.name),1),h("p",at," Type: "+M(r.value.type)+" | Size: "+M(r.value.size),1)])])):(p(),C("div",nt,n[0]||(n[0]=[h("p",null,"Loading image details...",-1)])))}}),st=x(it,[["__scopeId","data-v-db28c2a7"]]);/*! Fast Average Color | Â© 2025 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function ot(t){var e=t.toString(16);return e.length===1?"0"+e:e}function D(t){return"#"+t.map(ot).join("")}function lt(t){var e=(t[0]*299+t[1]*587+t[2]*114)/1e3;return e<128}function ct(t){return t?ut(t)?t:[t]:[]}function ut(t){return Array.isArray(t[0])}function H(t,e,r){for(var a=0;a<r.length;a++)if(dt(t,e,r[a]))return!0;return!1}function dt(t,e,r){switch(r.length){case 3:if(vt(t,e,r))return!0;break;case 4:if(ft(t,e,r))return!0;break;case 5:if(ht(t,e,r))return!0;break;default:return!1}}function vt(t,e,r){return t[e+3]!==255||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]}function ft(t,e,r){return t[e+3]&&r[3]?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3]:t[e+3]===r[3]}function _(t,e,r){return t>=e-r&&t<=e+r}function ht(t,e,r){var a=r[0],n=r[1],l=r[2],i=r[3],o=r[4],c=t[e+3],f=_(c,i,o);return i?!!(!c&&f||_(t[e],a,o)&&_(t[e+1],n,o)&&_(t[e+2],l,o)&&f):f}var gt=24;function mt(t,e,r){for(var a={},n=r.dominantDivider||gt,l=r.ignoredColor,i=r.step,o=[0,0,0,0,0],c=0;c<e;c+=i){var f=t[c],v=t[c+1],g=t[c+2],u=t[c+3];if(!(l&&H(t,c,l))){var s=Math.round(f/n)+","+Math.round(v/n)+","+Math.round(g/n);a[s]?a[s]=[a[s][0]+f*u,a[s][1]+v*u,a[s][2]+g*u,a[s][3]+u,a[s][4]+1]:a[s]=[f*u,v*u,g*u,u,1],o[4]<a[s][4]&&(o=a[s])}}var d=o[0],R=o[1],N=o[2],b=o[3],z=o[4];return b?[Math.round(d/b),Math.round(R/b),Math.round(N/b),Math.round(b/z)]:r.defaultColor}function pt(t,e,r){for(var a=0,n=0,l=0,i=0,o=0,c=r.ignoredColor,f=r.step,v=0;v<e;v+=f){var g=t[v+3],u=t[v]*g,s=t[v+1]*g,d=t[v+2]*g;c&&H(t,v,c)||(a+=u,n+=s,l+=d,i+=g,o++)}return i?[Math.round(a/i),Math.round(n/i),Math.round(l/i),Math.round(i/o)]:r.defaultColor}function bt(t,e,r){for(var a=0,n=0,l=0,i=0,o=0,c=r.ignoredColor,f=r.step,v=0;v<e;v+=f){var g=t[v],u=t[v+1],s=t[v+2],d=t[v+3];c&&H(t,v,c)||(a+=g*g*d,n+=u*u*d,l+=s*s*d,i+=d,o++)}return i?[Math.round(Math.sqrt(a/i)),Math.round(Math.sqrt(n/i)),Math.round(Math.sqrt(l/i)),Math.round(i/o)]:r.defaultColor}function S(t){return w(t,"defaultColor",[0,0,0,0])}function w(t,e,r){return t[e]===void 0?r:t[e]}var W=10,L=100;function yt(t){return t.search(/\.svg(\?|$)/i)!==-1}function It(t){if($(t)){var e=t.naturalWidth,r=t.naturalHeight;return!t.naturalWidth&&yt(t.src)&&(e=r=L),{width:e,height:r}}return Ct(t)?{width:t.videoWidth,height:t.videoHeight}:q(t)?{width:t.codedWidth,height:t.codedHeight}:{width:t.width,height:t.height}}function F(t){return Et(t)?"canvas":wt(t)?"offscreencanvas":q(t)?"videoframe":_t(t)?"imagebitmap":t.src}function $(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}var P=typeof OffscreenCanvas<"u";function wt(t){return P&&t instanceof OffscreenCanvas}function Ct(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function q(t){return typeof VideoFrame<"u"&&t instanceof VideoFrame}function Et(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function _t(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function Mt(t,e){var r=w(e,"left",0),a=w(e,"top",0),n=w(e,"width",t.width),l=w(e,"height",t.height),i=n,o=l;if(e.mode==="precision")return{srcLeft:r,srcTop:a,srcWidth:n,srcHeight:l,destWidth:i,destHeight:o};var c;return n>l?(c=n/l,i=L,o=Math.round(i/c)):(c=l/n,o=L,i=Math.round(o/c)),(i>n||o>l||i<W||o<W)&&(i=n,o=l),{srcLeft:r,srcTop:a,srcWidth:n,srcHeight:l,destWidth:i,destHeight:o}}var Tt=typeof window>"u";function Lt(){return Tt?P?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var Ht="FastAverageColor: ";function m(t){return Error(Ht+t)}function y(t,e){e||console.error(t)}var Rt=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(e,r){if(!e)return Promise.reject(m("call .getColorAsync() without resource"));if(typeof e=="string"){if(typeof Image>"u")return Promise.reject(m("resource as string is not supported in this environment"));var a=new Image;return a.crossOrigin=r&&r.crossOrigin||"",a.src=e,this.bindImageEvents(a,r)}else{if($(e)&&!e.complete)return this.bindImageEvents(e,r);var n=this.getColor(e,r);return n.error?Promise.reject(n.error):Promise.resolve(n)}},t.prototype.getColor=function(e,r){r=r||{};var a=S(r);if(!e){var n=m("call .getColor() without resource");return y(n,r.silent),this.prepareResult(a,n)}var l=It(e),i=Mt(l,r);if(!i.srcWidth||!i.srcHeight||!i.destWidth||!i.destHeight){var n=m('incorrect sizes for resource "'.concat(F(e),'"'));return y(n,r.silent),this.prepareResult(a,n)}if(!this.canvas&&(this.canvas=Lt(),!this.canvas)){var n=m("OffscreenCanvas is not supported in this browser");return y(n,r.silent),this.prepareResult(a,n)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var n=m("Canvas Context 2D is not supported in this browser");return y(n,r.silent),this.prepareResult(a)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=i.destWidth,this.canvas.height=i.destHeight;try{this.ctx.clearRect(0,0,i.destWidth,i.destHeight),this.ctx.drawImage(e,i.srcLeft,i.srcTop,i.srcWidth,i.srcHeight,0,0,i.destWidth,i.destHeight);var o=this.ctx.getImageData(0,0,i.destWidth,i.destHeight).data;return this.prepareResult(this.getColorFromArray4(o,r))}catch(c){var n=m("security error (CORS) for resource ".concat(F(e),`.
Details: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`));return y(n,r.silent),r.silent||console.error(c),this.prepareResult(a,n)}},t.prototype.getColorFromArray4=function(e,r){r=r||{};var a=4,n=e.length,l=S(r);if(n<a)return l;var i=n-n%a,o=(r.step||1)*a,c;switch(r.algorithm||"sqrt"){case"simple":c=pt;break;case"sqrt":c=bt;break;case"dominant":c=mt;break;default:throw m("".concat(r.algorithm," is unknown algorithm"))}return c(e,i,{defaultColor:l,ignoredColor:ct(r.ignoredColor),step:o,dominantDivider:r.dominantDivider})},t.prototype.prepareResult=function(e,r){var a=e.slice(0,3),n=[e[0],e[1],e[2],e[3]/255],l=lt(e);return{value:[e[0],e[1],e[2],e[3]],rgb:"rgb("+a.join(",")+")",rgba:"rgba("+n.join(",")+")",hex:D(a),hexa:D(e),isDark:l,isLight:!l,error:r}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(e,r){var a=this;return new Promise(function(n,l){var i=function(){f();var v=a.getColor(e,r);v.error?l(v.error):n(v)},o=function(){f(),l(m('Error loading image "'.concat(e.src,'"')))},c=function(){f(),l(m('Image "'.concat(e.src,'" loading aborted')))},f=function(){e.removeEventListener("load",i),e.removeEventListener("error",o),e.removeEventListener("abort",c)};e.addEventListener("load",i),e.addEventListener("error",o),e.addEventListener("abort",c)})},t}();const Ot={class:"buttons-container"},kt={class:"similar-controls"},At=["onClick"],Dt={class:"distance"},St=B({__name:"View",props:{id:{}},setup(t){const e=j(),r=G(),a=I(Number(e.params.id)||0),n=I(5),l=I([]),i=I("#FEE7F0"),o=async()=>{const u=new Rt,s=document.querySelector(".image-container img");if(s&&s.complete)try{const d=await u.getColorAsync(s);i.value=d.hex}catch(d){console.error("Erreur lors du calcul de la couleur moyenne :",d)}else s==null||s.addEventListener("load",async()=>{const d=await u.getColorAsync(s);i.value=d.hex})};E(a,async()=>{await o()}),V(()=>{o()});const c=async()=>{try{await T.deleteImage(a.value),alert("Image deleted successfully"),r.push("/gallery")}catch(u){console.error("Failed to delete image:",u),alert("Failed to delete image")}},f=async u=>{try{const s=await T.getSimilarImages(a.value,u);l.value=s}catch(s){console.error("Error fetching similar images:",s)}},v=u=>{r.push({name:"view",params:{id:u.toString()}})},g=async()=>{try{const u=await T.getImage(a.value),s=window.URL.createObjectURL(u),d=document.createElement("a");d.href=s,d.download=`image-${a.value}`,d.click(),window.URL.revokeObjectURL(s)}catch(u){console.error("Error downloading image:",u)}};return E(()=>e.params.id,u=>{a.value=Number(u)||0,f(n.value)},{immediate:!0}),E(n,u=>{u>0&&f(u)}),E(a,()=>{f(n.value)},{immediate:!0}),(u,s)=>(p(),C(k,null,[h("div",Ot,[h("button",{onClick:s[0]||(s[0]=d=>{U(r).push("/gallery")}),class:"return-button"},"Return"),h("button",{onClick:c,class:"delete-button"},"Delete"),h("button",{onClick:g,class:"download-button"},"Download")]),(p(),O(st,{id:a.value,key:a.value},null,8,["id"])),h("div",{class:"image-container",style:X({backgroundColor:i.value})},[(p(),O(A,{id:a.value,key:a.value,class:"img"},null,8,["id"]))],4),h("div",kt,[s[3]||(s[3]=h("h4",null,"Similar to this one:",-1)),Z(h("select",{id:"number-select","onUpdate:modelValue":s[1]||(s[1]=d=>n.value=d),class:"number-select"},s[2]||(s[2]=[K('<option value="1" data-v-c6693547>1</option><option value="3" data-v-c6693547>3</option><option value="5" data-v-c6693547>5</option><option value="10" data-v-c6693547>10</option><option value="20" data-v-c6693547>20</option>',5)]),512),[[J,n.value]])]),h("div",Y(u.$attrs,{class:"gallery"}),[(p(!0),C(k,null,Q(l.value,d=>(p(),C("div",{key:d.id,class:"img-wrapper",onClick:R=>v(d.id)},[tt(A,{id:d.id,class:"image-similar"},null,8,["id"]),h("span",Dt,M(d.distance.toFixed(2)),1)],8,At))),128))],16)],64))}}),xt=x(St,[["__scopeId","data-v-c6693547"]]);export{xt as default};
